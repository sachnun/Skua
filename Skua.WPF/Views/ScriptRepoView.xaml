<UserControl
    x:Class="Skua.WPF.Views.ScriptRepoView"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:vms="clr-namespace:Skua.Core.ViewModels;assembly=Skua.Core"
    d:DataContext="{d:DesignInstance vms:ScriptRepoViewModel}"
    d:DesignHeight="600"
    d:DesignWidth="850"
    mc:Ignorable="d">
    <Grid>
        <DockPanel>
            <!-- Search Bar - Simple -->
            <Border DockPanel.Dock="Top" Padding="8,6">
                <TextBox x:Name="SearchBox"
                         Padding="8,6"
                         FontSize="13"
                         BorderThickness="1"
                         BorderBrush="{DynamicResource MaterialDesignDivider}"
                         Background="{DynamicResource MaterialDesignCardBackground}"
                         TextChanged="TextBox_TextChanged">
                    <materialDesign:HintAssist.Hint>
                        <TextBlock Text="Search..." Opacity="0.5" />
                    </materialDesign:HintAssist.Hint>
                </TextBox>
            </Border>

            <!-- Status Bar -->
            <Border DockPanel.Dock="Bottom" Padding="10,5">
                <DockPanel>
                    <TextBlock DockPanel.Dock="Left" 
                               VerticalAlignment="Center" 
                               Opacity="0.6" 
                               FontSize="11">
                        <Run Text="{Binding BotScriptQuantity, Mode=OneWay, FallbackValue=0}" FontWeight="SemiBold" />
                        <Run Text="scripts" />
                        <Run Text="â€¢" />
                        <Run Text="{Binding DownloadedQuantity, Mode=OneWay, FallbackValue=0}" Foreground="#4CAF50" FontWeight="SemiBold" />
                        <Run Text="ready" />
                    </TextBlock>
                    
                    <!-- Progress indicator -->
                    <StackPanel DockPanel.Dock="Right" 
                                Orientation="Horizontal"
                                Visibility="{Binding IsBusy, Converter={StaticResource BooleanToVisibilityConverter}}">
                        <ProgressBar Style="{StaticResource MaterialDesignCircularProgressBar}"
                                     IsIndeterminate="True"
                                     Width="12" Height="12"
                                     Margin="0,0,6,0" />
                        <TextBlock Text="{Binding ProgressReportMessage}"
                                   FontSize="11"
                                   Opacity="0.6"
                                   VerticalAlignment="Center"
                                   MaxWidth="180"
                                   TextTrimming="CharacterEllipsis" />
                    </StackPanel>
                </DockPanel>
            </Border>

            <!-- Scripts List -->
            <ListBox ItemsSource="{Binding Scripts}"
                     SelectedItem="{Binding SelectedItem}"
                     SelectionMode="Single"
                     VirtualizingPanel.IsVirtualizing="True"
                     VirtualizingPanel.VirtualizationMode="Recycling"
                     ScrollViewer.HorizontalScrollBarVisibility="Disabled"
                     BorderThickness="0"
                     Padding="4,2">
                <ListBox.ContextMenu>
                    <ContextMenu>
                        <MenuItem Command="{Binding DownloadCommand}"
                                  Header="Download"
                                  IsEnabled="{Binding SelectedItem.Downloaded, Converter={StaticResource InvertBooleanConverter}, FallbackValue=False}">
                            <MenuItem.Icon>
                                <materialDesign:PackIcon Kind="Download" />
                            </MenuItem.Icon>
                        </MenuItem>
                        <MenuItem Command="{Binding DeleteCommand}"
                                  Header="Delete"
                                  IsEnabled="{Binding SelectedItem.Downloaded, FallbackValue=False}">
                            <MenuItem.Icon>
                                <materialDesign:PackIcon Kind="Delete" />
                            </MenuItem.Icon>
                        </MenuItem>
                        <Separator />
                        <MenuItem Command="{Binding OpenScriptCommand}"
                                  Header="Open in VSCode"
                                  IsEnabled="{Binding SelectedItem.Downloaded, FallbackValue=False}">
                            <MenuItem.Icon>
                                <materialDesign:PackIcon Kind="CodeBraces" />
                            </MenuItem.Icon>
                        </MenuItem>
                    </ContextMenu>
                </ListBox.ContextMenu>
                <ListBox.ItemContainerStyle>
                    <Style TargetType="ListBoxItem" BasedOn="{StaticResource MaterialDesignListBoxItem}">
                        <Setter Property="Padding" Value="0" />
                        <Setter Property="Margin" Value="0,1" />
                        <Setter Property="HorizontalContentAlignment" Value="Stretch" />
                    </Style>
                </ListBox.ItemContainerStyle>
                <ListBox.ItemTemplate>
                    <DataTemplate>
                        <Border CornerRadius="3" Padding="10,7">
                            <Border.Style>
                                <Style TargetType="Border">
                                    <Setter Property="Background" Value="{DynamicResource MaterialDesignCardBackground}" />
                                    <Setter Property="BorderThickness" Value="0,0,3,0" />
                                    <Setter Property="BorderBrush" Value="Transparent" />
                                    <Setter Property="Opacity" Value="0.5" />
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding Downloaded}" Value="True">
                                            <Setter Property="BorderBrush" Value="#4CAF50" />
                                            <Setter Property="Opacity" Value="1" />
                                        </DataTrigger>
                                        <DataTrigger Binding="{Binding Outdated}" Value="True">
                                            <Setter Property="BorderBrush" Value="#FF9800" />
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </Border.Style>
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*" />
                                    <ColumnDefinition Width="Auto" />
                                </Grid.ColumnDefinitions>

                                <!-- Script Info -->
                                <StackPanel Grid.Column="0" VerticalAlignment="Center">
                                    <!-- Name -->
                                    <TextBlock Text="{Binding Info.Name}"
                                               FontSize="13"
                                               FontWeight="SemiBold"
                                               TextTrimming="CharacterEllipsis" />
                                    
                                    <!-- Description -->
                                    <TextBlock Text="{Binding Info.Description}"
                                               FontSize="11"
                                               Opacity="0.6"
                                               TextTrimming="CharacterEllipsis"
                                               Margin="0,2,10,0" />
                                    
                                    <!-- Tags -->
                                    <ItemsControl ItemsSource="{Binding InfoTags}" Margin="0,4,0,0">
                                        <ItemsControl.ItemsPanel>
                                            <ItemsPanelTemplate>
                                                <WrapPanel />
                                            </ItemsPanelTemplate>
                                        </ItemsControl.ItemsPanel>
                                        <ItemsControl.ItemTemplate>
                                            <DataTemplate>
                                                <Border Background="{DynamicResource MaterialDesignToolBarBackground}"
                                                        CornerRadius="2"
                                                        Padding="5,1"
                                                        Margin="0,0,3,0">
                                                    <TextBlock Text="{Binding}" FontSize="9" Opacity="0.7" />
                                                </Border>
                                            </DataTemplate>
                                        </ItemsControl.ItemTemplate>
                                    </ItemsControl>
                                </StackPanel>

                                <!-- Select Button -->
                                <Button Grid.Column="1"
                                        Style="{StaticResource MaterialDesignFlatButton}"
                                        Command="{Binding LoadScriptCommand}"
                                        CommandParameter="{Binding}"
                                        IsEnabled="{Binding Downloaded}"
                                        VerticalAlignment="Center"
                                        Padding="10,4"
                                        MinWidth="60">
                                    <TextBlock Text="Select" FontSize="12" />
                                </Button>
                            </Grid>
                        </Border>
                    </DataTemplate>
                </ListBox.ItemTemplate>
            </ListBox>
        </DockPanel>
    </Grid>
</UserControl>
